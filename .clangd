# clangd config for PlatformIO cross-compilation (xtensa-esp32 / xtensa-lx106)
#
# The compile_commands.json is generated by PlatformIO for the xtensa cross-compiler.
# clangd uses its built-in clang, which doesn't understand some gcc/xtensa flags.
# We strip those here so clangd can index the codebase cleanly.
#
# For best results, configure your editor to pass:
#   --query-driver=**/xtensa-esp32-elf-*,**/xtensa-lx106-elf-*
# to the clangd binary. This tells clangd to query the cross-compiler for its
# built-in defines and system include paths. Examples:
#   VS Code (clangd extension): "clangd.arguments": ["--query-driver=**/xtensa-*-elf-*"]
#   Neovim (lspconfig):         cmd = {"clangd", "--query-driver=**/xtensa-*-elf-*"}

CompileFlags:
  CompilationDatabase: apps/led-panel/
  Remove:
    # gcc/xtensa-specific flags that clangd's built-in clang doesn't understand
    - -mlongcalls
    - -fno-tree-switch-conversion
    - -fstrict-volatile-bitfields
    - -freorder-blocks
